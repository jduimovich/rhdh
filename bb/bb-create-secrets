SCRIPTDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )" 

# Scripts to configure three namespaces for dev,stage,prod
# the namespaces can exist in advance or you can run the templates and 
# the namespaces will be created by app of apps
# you can reuse a namespace trio across multiple templates
# or every time. 
source $SCRIPTDIR/util/verify-deps-exist "WEBHOOK_SECRET_ALL_PROVIDERS BITBUCKET_USER BITBUCKET_APP_PASSWORD" "oc" 

APP_NS_DEV=rhtap-app-development 
SECRET_NAME=bitbucket-auth-secret 

echo "Delete and recreate secrets $SECRET_NAME in $APP_NS_DEV"

oc delete -n $APP_NS_DEV secret $SECRET_NAME 
oc -n $APP_NS_DEV create secret generic $SECRET_NAME \
  --from-literal provider.token="$BITBUCKET_APP_PASSWORD" \
  --from-literal username="$BITBUCKET_USER" \
  --from-literal password="$BITBUCKET_APP_PASSWORD"
 
WEBHOOK=https://$(oc get routes -n openshift-pipelines pipelines-as-code-controller -ojsonpath={.spec.host})
echo
echo "Set your webhook to = $WEBHOOK" 